@model Inkopslista.ViewModels.NewRecipeViewModel
@{
    ViewBag.Title = "Nytt recept";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<h2>Nytt recept</h2>
<h4>@Html.ActionLink("Tillbaka", "Index", "Recipe", null, new { @class = "btn btn-primary"})</h4>

@using (Html.BeginForm("Create", "Recipe"))
{
    <fieldset>
        <div class="form-group" >
            <label class="col-md-2 control-label">
                Namn:
            </label>
            <div class="col-md-10">
                @Html.TextBoxFor(m => m.Recipe.Name, new { placeholder = Model.Recipe.Name, @class = "form-control" })
            </div>
        </div>
        <div class="form-group" style="margin-top:50px;">
            <label class="col-md-2 control-label">
                Tillagningstid: 
            </label>
            <div class="col-md-10">
                @Html.TextBoxFor(m => m.Recipe.CookingTimeH, new { placeholder = Model.CookingTimeH, @class = "form-control", style="width: 40px; float: left"}) h 
                @Html.TextBoxFor(m => m.Recipe.CookingTimeM, new { placeholder = Model.CookingTimeM, @class = "form-control", style="width: 40px; display: inline-block" }) min
            </div>
        </div>
        <div class="form-group" style="margin-top:100px;">
            <label class="col-md-2 control-label">
                Portioner:
            </label>
            <div class="col-md-10">
                @Html.TextBoxFor(m => m.Recipe.Portions, new { placeholder = Model.Portions, @class = "form-control", style="width: 40px" })
            </div>
        </div>
            <div class="form-group" style="margin-top: 150px;">
                <label class="col-md-2 control-label">
                    Lägg till ingrediens:
                </label>
                <div class="col-md-10">
                    @*
                    @Html.HiddenFor(m => m.Recipe.Product.FoodId, new { @id = "id"})
                    @Html.HiddenFor(m => m.Recipe.Product.FoodName, new { @id = "foodname"})
                    *@
                    <input type="text" class="form-control" id="searchInput" placeholder="Börja skriv i" />
                </div>
            </div>
            <div class="form-group" style="margin-top: 100px;">
                <label class="col-md-2 control-label">
                </label>
                <div class="col-md-10">
                    @Html.HiddenFor(m => m.Recipe.Id)

                    <button type="submit"  name="command" value="AddIngredient" class="btn btn-primary">Lägg till ingrediens</button>
                </div>
            </div>

            <div class="form-group" style="margin-top: 100px;">

                <label class="col-md-2 control-label">
                    Ingredienser:
                </label>
                <div class="col-md-10">
                    <table class="table table-bordered table-hover" style="margin-top: 10px">
                        <thead>
                        <tr bgcolor="#f5f5f5">
                            <th>Vara:</th>
                            <th>Mängd (g):</th>
                            <th>Pris/kg:</th>
                            <th>Pris:</th>
                            <th>Ändra:</th>
                        </tr>
                        </thead>
                        <tbody>

                        @if (Model.Products != null)
                        {
                            for (int i = 0; i < Model.Products.Count; i++)
                            {
                                <tr>
                                    <td>
                                        @Html.DisplayFor(m => m.Products[i].Food.Name)
                                        @Html.HiddenFor(m => m.Products[i].Food.Id)
                                    </td>
                                     <td>
                                        @Html.DisplayFor(m => m.Products[i].Mass) g
                                        @Html.HiddenFor(m => m.Products[i].Mass)
                                    </td>
                                     <td>
                                        @Html.DisplayFor(m => m.Products[i].PricePerKg) kr
                                        @Html.HiddenFor(m => m.Products[i].PricePerKg)
                                    </td>
                                     <td>
                                        @Html.DisplayFor(m => m.Products[i].PriceTotal) kr
                                        @Html.HiddenFor(m => m.Products[i].PriceTotal)
                                    </td>
                                    <td>
                                        <img src="..\..\Icons\edit.svg" width="20" height="20"/>
                                        &nbsp;
                                        <img src="..\..\Icons\delete.svg" width="20" height="20"/>
                                    </td>
                                </tr>
                            }
                        }
                        </tbody>
                    </table>
                </div>
            </div>
        <div class="form-group" style="margin-top:150px;">
            <label class="col-md-2 control-label">
            </label>
            <div class="col-md-10">
                <button type="submit" name="command" value="Create" class="btn btn-primary">Lägg till recept</button>
            </div>
        </div>
    </fieldset>
}@section Scripts {
     <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
     <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
     <script src="~/Scripts/jquery-ui-1.12.1.min.js"></script>

     <script type="text/javascript">
         $(document).ready(function() {

             $("#searchInput").autocomplete({
                     source: function (request, response) {
                         $.ajax({
                             url: '@Url.Action("GetFood","Shoppinglist")',
                             dataType: "json",
                             data: { term: $("#searchInput").val() },
                             success: function (data) {
                                 response($.map(data, function (item) {
                                     return { label: item.label, value: item.label, id: item.id };
                                 }));
                             },
                             error: function (xhr, status, error) {
                                 alert("Error");
                             }
                         });
                     },
                     select: function(event, ui) {
                         $("#id").val(ui.item.id);
                         $("#searchInput").val(ui.item.label);
                         return false;
                     }
                 }),
                 $('#searchInput').change(function() {
                     $('#foodname').val($('#searchInput').val());
                 });
             ;
         });
     </script>
 }
